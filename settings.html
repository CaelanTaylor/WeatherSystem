<!DOCTYPE html>
<html>
    <head>
        <meta charset="UTF-8">
        <title>Settings - WindScout</title>
        <link rel="stylesheet" href="style.css">
        <script>
            // Function to fetch current settings
            async function loadSettings() {
                try {
                    const response = await fetch('/settings');
                    const settings = await response.json();
                    document.getElementById('location').value = settings.location || 'Test Location';
                    document.getElementById('enable_storage').checked = settings.enable_storage === true;
                } catch (error) {
                    console.error('Error loading settings:', error);
                    // Set default values if loading fails
                    document.getElementById('location').value = 'Test Location';
                    document.getElementById('enable_storage').checked = true;
                }
            }

            // Function to save settings
            async function saveSettings(event) {
                event.preventDefault(); // Prevent default form submission

                const location = document.getElementById('location').value;
                const enable_storage = document.getElementById('enable_storage').checked;

                try {
                    const response = await fetch('/settings', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            location: location,
                            enable_storage: enable_storage
                        })
                    });

                    if (response.ok) {
                        alert('Settings saved successfully! You may need to restart the data receiver (recv.py) for all changes to take effect.');
                    } else {
                        alert('Failed to save settings.');
                    }
                } catch (error) {
                    console.error('Error saving settings:', error);
                    alert('An error occurred while saving settings.');
                }
            }

            // Load settings when the page loads
            window.onload = loadSettings;
        </script>
    </head>
    <body>
        <div class="navbar">
            <div class="logo">
                <h1>WindScout</h1>
            </div>
            <div class="navitems">
                <ul>
                    <li><a href="index.html">LiveWeather</a></li>
                    <li><a href="10mtrend.html">10 Minute Trend</a></li>
                    <li><a href="1htrend.html">1 Hour Trend</a></li>
                    <li><a href="analysis.html">Analysis</a></li>
                    <li><a href="settings.html"><b>Settings</b></a></li>
                </ul>
            </div>
        </div>
        <div class="content">
            <div class="title">
                <h1>Settings</h1>
                <div class="line"></div>
            </div>

            <div class="settings-form">
                <form onsubmit="saveSettings(event)">
                    <h2>Data Configuration</h2>
                    <label for="location">Location Name:</label><br>
                    <input type="text" id="location" name="location" required><br><br>

                    <input type="checkbox" id="enable_storage" name="enable_storage">
                    <label for="enable_storage"> Enable Data Storage (Save live data to database)</label><br><br>

                    <button type="submit">Save Settings</button>
                </form>
            </div>
        </div>
    </body>
</html>