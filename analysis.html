<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Analysis - WindScout</title>
    <link rel="stylesheet" href="style.css">
</head>
<body >
    <div class="navbar">
        <div class="logo">
            <h1>WindScout</h1>
        </div>
        <div class="navitems">
            <ul>
                <li><a href="index.html">LiveWeather</a></li>
                <li><a href="10mtrend.html">10 Minute Trend</a></li>
                <li><a href="1htrend.html">1 Hour Trend</a></li>
                <li><a href="analysis.html"><b >Analysis</b></a></li>
                <li><a href="settings.html">Settings</a></li>
            </ul>
        </div>
        <button class="menu-toggle" onclick="updateForecast()">Update Forecast</button>
    </div>
    <div class="content">
        <div class="title">
            <h1>Weather Analysis</h1>
            <div class="line"></div>
        </div>
        <div id="forecast-display">
            <h2>Forecast Section</h2>
            <p>This section will display weather forecasts and analysis based on recent data.</p>
            <div id="loading-indicator" style="display: none;">
                <p>Generating forecast...</p>
            </div>
        </div>
    </div>
    <script>
        function updateForecast() {
            document.getElementById('loading-indicator').style.display = 'block';
            document.getElementById('forecast-display').innerHTML = '<h2>Forecast Section</h2><p>Generating forecast...</p><div id="loading-indicator" style="display: block;">Generating forecast...</div>';

            fetch('http://192.168.192.186:5001/get_recent_weather_data')
                .then(response => response.json())
                .then(data => {
                    if (data && data.length > 0) {
                        window.ai_thread = window.ai_thread || new Promise((resolve, reject) => {
                            fetch('http://192.168.192.186:5001/generate_forecast', {
                                method: 'POST',
                                headers: {
                                    'Content-Type': 'application/json'
                                },
                                body: JSON.stringify({ weather_data: data })
                            })
                            .then(response => response.text())
                            .then(forecast => {
                                document.getElementById('forecast-display').innerHTML = `<h2>Forecast Section</h2><p>${forecast}</p>`;
                                document.getElementById('loading-indicator').style.display = 'none';
                                resolve();
                            })
                            .catch(error => {
                                console.error('Error generating forecast:', error);
                                document.getElementById('forecast-display').innerHTML = `<p>Error generating forecast.</p>`;
                                document.getElementById('loading-indicator').style.display = 'none';
                                reject(error);
                            });
                        });
                    } else {
                        document.getElementById('forecast-display').innerHTML = `<p>No data available.</p>`;
                        document.getElementById('loading-indicator').style.display = 'none';
                    }
                })
                .catch(error => {
                    console.error('Error fetching data:', error);
                    document.getElementById('forecast-display').innerHTML = `<p>Error fetching data.</p>`;
                    document.getElementById('loading-indicator').style.display = 'none';
                });
        }
    </script>
</body>
</html>