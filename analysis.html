<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Weather Analysis - WindScout</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="navbar">
        <div class="logo">
            <h1>WindScout</h1>
        </div>
        <div class="navitems">
            <ul>
                <li><a href="index.html">LiveWeather</a></li>
                <li><a href="10mtrend.html">10 Minute Trend</a></li>
                <li><a href="1htrend.html">1 Hour Trend</a></li>
                <li><a href="analysis.html"><b>Analysis</b></a></li>
                <li><a href="settings.html">Settings</a></li>
            </ul>
        </div>
        <button class="menu-toggle" onclick="toggleMenu()">â˜°</button>
    </div>

    <div class="content">
        <div class="title">
            <h1>Weather Analysis</h1>
            <div class="line"></div>
            <h2 id="current-location" style="text-align: center; color: #00bcd4; margin-top: -15px;"></h2>
        </div>

        <div class="forecast-container">
            <button onclick="updateForecast()">Generate New Forecast</button>
            <div id="forecast-display">
                <p>Click 'Generate New Forecast' to analyze historical data and get a prediction.</p>
                <div id="loading-indicator" style="display: none;">
                    <p>Generating forecast...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'http://192.168.192.186:5001'; 

        function toggleMenu() {
            document.querySelector('.navitems').classList.toggle('open');
        }
        
        async function fetchLocation() {
            try {
                const res = await fetch(`${API_BASE_URL}/latest`);
                const data = await res.json();
                document.getElementById('current-location').textContent = data.location || "Loading...";
            } catch (e) {
                document.getElementById('current-location').textContent = "Connection Error";
            }
        }

        function updateForecast() {
            const forecastDisplay = document.getElementById('forecast-display');
            const loadingIndicator = document.getElementById('loading-indicator');

            forecastDisplay.innerHTML = `<p>Generating forecast...</p>`;
            loadingIndicator.style.display = 'block';

            fetch(`${API_BASE_URL}/generate_forecast`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' }
            })
                .then(response => {
                    if (!response.ok) {
                        return response.json().then(err => { throw new Error(err.error || response.statusText); });
                    }
                    return response.json();
                })
                .then(data => {
                    if (data.error) {
                        throw new Error(data.error);
                    }

                    forecastDisplay.innerHTML = `<pre>${data.forecast}</pre>`;
                })
                .catch(error => {
                    console.error('Error:', error);
                    forecastDisplay.innerHTML = `<p>An error occurred: ${error.message}</p>`;
                })
                .finally(() => {
                    loadingIndicator.style.display = 'none';
                });
        }

        fetchLocation();
        updateForecast(); // Auto-run forecast on page load
    </script>
</body>
</html>