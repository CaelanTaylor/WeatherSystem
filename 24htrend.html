<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>24 Hour Wind Trend - WindScout</title>
    <link rel="stylesheet" href="style.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="navbar">
        <div class="logo">
            <h1>WindScout</h1>
        </div>
        <div class="navitems">
            <ul>
                <li><a href="index.html">LiveWeather</a></li>
                <li><a href="10mtrend.html">10 Minute Trend</a></li>
                <li><a href="1htrend.html">1 Hour Trend</a></li>
                <li><a href="analysis.html">Analysis</a></li>
                <li><a href="settings.html">Settings</a></li>
                <li class="active"><a href="24htrend.html"><b>24 Hour Trend</b></a></li>
            </ul>
        </div>
        <button class="menu-toggle" onclick="toggleMenu()">☰</button>
    </div>
    <div class="content">
        <div class="title">
            <h1>24 Hour Summary</h1>
            <div class="line"></div>
            <h2 id="current-location" style="text-align: center; color: #00bcd4; margin-top: -15px;"></h2>
        </div>
        <div class="dashboard">
            <div class="weather-item">
                <div class="label">24H AVG WIND SPEED</div>
                <div class="gauge-value"><span id="avgWind">--</span><div class="unit">knots</div></div>
            </div>
            <div class="weather-item">
                <div class="label">24H MAX GUST</div>
                <div class="gauge-value"><span id="maxGust">--</span><div class="unit">knots</div></div>
            </div>
            <div class="weather-item">
                <div class="label">24H AVG DIRECTION</div>
                <div class="gauge-value"><span id="avgDir">--</span><div class="unit">°</div></div>
            </div>
            <div class="weather-item" style="flex-basis: 100%;">
                <div class="label">Timeframe</div>
                <div style="font-size: 1.2rem; font-weight: 500;">Last 24 Hours</div>
            </div>
        </div>
        <script>
            const API_BASE_URL = 'http://192.168.192.186:5001'; 

            function toggleMenu() {
                document.querySelector('.navitems').classList.toggle('open');
            }

            async function drawSummaryData() {
                try {
                    // Fetch location for display
                    const latestRes = await fetch(`${API_BASE_URL}/latest`);
                    const latestData = await latestRes.json();
                    document.getElementById('current-location').textContent = latestData.location || "Loading...";

                    // Fetch 24H aggregate data
                    const res = await fetch(`${API_BASE_URL}/trend24h`);
                    const data = await res.json();

                    if (!data || data.length === 0) {
                         document.getElementById('avgWind').textContent = 'N/A';
                         document.getElementById('maxGust').textContent = 'N/A';
                         document.getElementById('avgDir').textContent = 'N/A';
                        return;
                    }

                    const summary = data[0]; // trend24h returns a list with one object

                    document.getElementById('avgWind').textContent = (summary.avg_wind || 0).toFixed(1);
                    document.getElementById('maxGust').textContent = (summary.max_gust || 0).toFixed(1);
                    document.getElementById('avgDir').textContent = (summary.avg_dir || 0).toFixed(0);

                } catch (error) {
                    console.error("Error fetching 24h data:", error);
                    document.getElementById('avgWind').textContent = 'Error';
                    document.getElementById('maxGust').textContent = 'Error';
                    document.getElementById('avgDir').textContent = 'Error';
                }
            }

            drawSummaryData();
            setInterval(drawSummaryData, 60000); // Update every minute
        </script>
</body>
</html>